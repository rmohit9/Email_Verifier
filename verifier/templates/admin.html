<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="UTF-8" />
  {% load static %}
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VerifyPro ‚Äì Admin Dashboard</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{% static 'css/admin.css' %}">
</head>

<body class="bg-slate-100 font-display flex h-screen overflow-hidden">

<!-- SIDEBAR -->
<aside class="w-64 bg-white border-r p-6 flex flex-col">

  <!-- LOGO -->
  <div class="mb-8 flex justify-center">
    <!-- ADD YOUR GRAPHURA LOGO HERE -->
    <img src="{% static 'bg removed.png' %}" alt="Logo" class="h-12 object-contain">
  </div>

  <nav class="flex flex-col gap-2">
    <a href="{% url 'admin_dashboard' %}" class="sidebar-link active">Dashboard</a>
    <a href="{% url 'user_dashboard' %}" class="sidebar-link">Users</a>
    <a href="{% url 'logs' %}" class="sidebar-link">Logs</a>
    {% if request.user.is_staff %}
    <a href="{% url 'email_campaign' %}" class="sidebar-link">Email Campaigns</a>
    {% endif %}
    <a href="{% url 'settings' %}" class="sidebar-link">Settings</a>
  </nav>

  <div class="mt-auto text-sm text-slate-500">
    <span id="adminName">Super Admin</span><br>
    <span class="text-xs">Super Admin</span>
  </div>
</aside>

<!-- MAIN -->
<main class="flex-1 overflow-y-auto p-8">

  <!-- HEADER -->
  <header class="mb-8">
    <div class="mb-6">
      <h2 class="text-3xl font-bold">Dashboard</h2>
      <p class="text-slate-500">System statistics and overview</p>
    </div>
  </header>

  <!-- STATS CARDS -->
  <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Total Jobs -->
    <div class="bg-white rounded-xl shadow-sm p-6">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-slate-500 text-sm font-medium">Total Jobs</p>
          <h3 class="text-4xl font-bold text-slate-900 mt-2">{{ stats.total_jobs }}</h3>
        </div>
        <div class="bg-blue-100 p-3 rounded-lg">
          <span class="text-2xl">üìä</span>
        </div>
      </div>
      <p class="text-slate-500 text-xs mt-3">All verification jobs created</p>
    </div>

    <!-- Jobs Done -->
    <div class="bg-white rounded-xl shadow-sm p-6">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-slate-500 text-sm font-medium">Jobs Done</p>
          <h3 class="text-4xl font-bold text-slate-900 mt-2">{{ stats.completed_jobs }}</h3>
        </div>
        <div class="bg-green-100 p-3 rounded-lg">
          <span class="text-2xl">‚úÖ</span>
        </div>
      </div>
      <p class="text-slate-500 text-xs mt-3">Successfully completed</p>
    </div>

    <!-- Mails Checked -->
    <div class="bg-white rounded-xl shadow-sm p-6">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-slate-500 text-sm font-medium">Mails Checked</p>
          <h3 class="text-4xl font-bold text-slate-900 mt-2">{{ stats.total_emails|default:'0' }}</h3>
        </div>
        <div class="bg-purple-100 p-3 rounded-lg">
          <span class="text-2xl">üìß</span>
        </div>
      </div>
      <p class="text-slate-500 text-xs mt-3">Total emails verified</p>
    </div>

    <!-- Anomalies Found -->
    <div class="bg-white rounded-xl shadow-sm p-6">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-slate-500 text-sm font-medium">Anomalies Found</p>
          <h3 class="text-4xl font-bold text-red-600 mt-2">{{ stats.anomalies|default:'0' }}</h3>
        </div>
        <div class="bg-red-100 p-3 rounded-lg">
          <span class="text-2xl">‚ö†Ô∏è</span>
        </div>
      </div>
      <p class="text-slate-500 text-xs mt-3">Invalid & disposable emails</p>
    </div>
  </section>

  <!-- EMAIL BREAKDOWN CARDS removed per request -->
  <!-- Section removed: Valid / Invalid / Disposable cards -->

  <!-- ANALYTICS CHARTS SECTION -->
  <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <!-- Job Status Distribution -->
    <div class="bg-white rounded-xl shadow-sm p-6">
      <h3 class="text-lg font-semibold mb-4">Job Status Distribution</h3>
      <div class="relative h-72">
        <canvas id="jobStatusChart"></canvas>
      </div>
    </div>

    <!-- Email Verification Results -->
    <div class="bg-white rounded-xl shadow-sm p-6">
      <h3 class="text-lg font-semibold mb-4">Email Verification Results</h3>
      <div class="relative h-72">
        <canvas id="emailResultsChart"></canvas>
      </div>
    </div>
  </section>

  <!-- ADMIN MANAGEMENT SECTION moved to Settings page -->
  <!-- Section removed and relocated to Settings -->

</main>

<script>
// Job Status Distribution Chart
const jobStatusCtx = document.getElementById('jobStatusChart').getContext('2d');
const jobStatusChart = new Chart(jobStatusCtx, {
  type: 'doughnut',
  data: {
    labels: ['Completed', 'Pending', 'Processing', 'Failed'],
    datasets: [{
      data: [
        {{ analytics.job_status.completed }},
        {{ analytics.job_status.pending }},
        {{ analytics.job_status.processing }},
        {{ analytics.job_status.failed }}
      ],
      backgroundColor: ['#10b981', '#f59e0b', '#3b82f6', '#ef4444'],
      borderColor: ['#059669', '#d97706', '#1d4ed8', '#dc2626'],
      borderWidth: 2
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        position: 'bottom',
        labels: { padding: 15, usePointStyle: true }
      }
    }
  }
});

// Email Verification Results Chart
const emailResultsCtx = document.getElementById('emailResultsChart').getContext('2d');
const emailResultsChart = new Chart(emailResultsCtx, {
  type: 'bar',
  data: {
    labels: ['Valid', 'Invalid', 'Disposable'],
    datasets: [{
      label: 'Email Count',
      data: [
        {{ analytics.email_verification.valid }},
        {{ analytics.email_verification.invalid }},
        {{ analytics.email_verification.disposable }}
      ],
      backgroundColor: ['#10b981', '#ef4444', '#f59e0b'],
      borderColor: ['#059669', '#dc2626', '#d97706'],
      borderWidth: 1,
      borderRadius: 8
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    indexAxis: 'y',
    plugins: {
      legend: { display: true, position: 'top' }
    },
    scales: {
      x: { beginAtZero: true, ticks: { stepSize: 1 } }
    }
  }
});
</script>

</body>
</html>
